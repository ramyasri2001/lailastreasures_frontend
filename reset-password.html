<!DOCTYPE html>
<html>
<head>
  <title>Reset Password - Laila's Treasures</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    main {
      max-width: 400px;
      margin: auto;
      padding-top: 3rem;
    }
    input {
      width: 100%;
    }
  </style>
</head>
<body>
<header>
  <div class="logo">Laila's Treasures</div>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="grillz.html">Grillz</a></li>
      <li><a href="login.html">Login</a></li>
    </ul>
  </nav>
</header>

<main>
  <h1>Reset Your Password</h1>
  <form id="resetForm" onsubmit="handleReset(event)">
 <input type="password" id="newPassword" placeholder="Enter new password" required> <span id="togglePassword" style = "cursor: pointer;">üëÅÔ∏è</span>
</div>      
<button type="submit">Reset Password</button>
  </form>
</main>

<script>
    
  async function handleReset(event) {
    event.preventDefault();

    const params = new URLSearchParams(window.location.search);
    const email = params.get("email");
    const token = params.get("token");
    const newPassword = document.getElementById("newPassword").value;

    if (!email || !token) {
      alert("Invalid or expired reset link.");
      return;
    }

    const res = await fetch("https://lailastreasures.onrender.com/api/users/reset-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, token, newPassword })
    });

    const data = await res.json();
    if (res.ok) {
      alert("Password reset successful! Please log in.");
      window.location.href = "login.html";
    } else {
      alert(data.message || "Reset failed. Try again.");
    }
  };
  document.getElementById("togglePassword").addEventListener("click", function () {
    const passwordInput = document.getElementById("newPassword");
    const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
    passwordInput.setAttribute("type", type);
    this.textContent = type === "password" ? "üëÅÔ∏è" : "üôà";
  });
</script>
</body>
</html>