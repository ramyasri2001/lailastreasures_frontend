<header>
  <div class="logo">Laila's Treasures</div>
  <nav>
    <ul id="navMenu">
      <li><a href="grillz.html">Grillz</a></li>
      <li><a href="cart.html">Saved Designs</a></li>
      <li><a href="contact.html">Contact</a></li>
      <!-- user items will be injected here -->
    </ul>
  </nav>
</header>

<script>
  const API_BASE = "https://lailastreasures.onrender.com";

  async function refreshHeader() {
    const nav = document.getElementById("navMenu");

    // remove previously injected user-specific items
    nav.querySelectorAll(".user-nav").forEach(el => el.remove());

    try {
      const r = await fetch(`${API_BASE}/api/users/me`, { credentials: "include" });
      const me = r.ok ? await r.json() : { loggedIn: false };

      if (me.loggedIn) {
        // show (Name) + Logout
        const liName = document.createElement("li");
        liName.className = "user-nav";
        liName.innerHTML = `<span style="font-weight:bold;color:yellow;">(${me.name || "User"})</span>`;
        nav.appendChild(liName);

        const liLogout = document.createElement("li");
        liLogout.className = "user-nav";
        liLogout.innerHTML = `<a href="#" id="logoutBtn">Logout</a>`;
        nav.appendChild(liLogout);

        document.getElementById("logoutBtn").addEventListener("click", handleLogout);
      } else {
        // show Login + Create Account
        const liLogin = document.createElement("li");
        liLogin.className = "user-nav";
        liLogin.innerHTML = `<a href="login.html">Login</a>`;
        nav.appendChild(liLogin);

        const liRegister = document.createElement("li");
        liRegister.className = "user-nav";
        liRegister.innerHTML = `<a href="register.html">Create Account</a>`;
        nav.appendChild(liRegister);
      }
    } catch (err) {
      console.error("Header refresh error:", err);
      // fallback: show login links
      const liLogin = document.createElement("li");
      liLogin.className = "user-nav";
      liLogin.innerHTML = `<a href="login.html">Login</a>`;
      nav.appendChild(liLogin);

      const liRegister = document.createElement("li");
      liRegister.className = "user-nav";
      liRegister.innerHTML = `<a href="register.html">Create Account</a>`;
      nav.appendChild(liRegister);
    }
  }

  async function handleLogout(e) {
    e.preventDefault();
    try { await fetch(`${API_BASE}/api/users/logout`, { method: "POST", credentials: "include" }); } catch {}
    location.href = "login.html";
  }

  refreshHeader();
</script>