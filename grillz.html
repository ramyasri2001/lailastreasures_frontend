<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Grillz – Laila's Treasures</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .product-gallery{display:flex;flex-wrap:wrap;justify-content:center;gap:2rem;margin-top:2rem}
    .product{width:260px;text-align:center}
    .product img{width:100%;height:180px;object-fit:cover;border-radius:8px}
  </style>
</head>
<body>
<header>
  <div class="logo">Laila's Treasures</div>
  <nav>
    <ul id="navMenu">
      <li><a href="index.html">Home</a></li>
      <li><a href="cart.html">Saved Designs</a></li>
      <li><a href="contact.html">Contact</a></li>
      <!-- user items injected by auth-header.js -->
    </ul>
  </nav>
</header>

<!-- Reusable auth header controller -->
<script src="assets/js/auth-header.js"></script>

<main>
  <h1 style="text-align:center;">Choose Your Grillz Metal</h1>
  <p style="text-align:center;font-size:1.1rem;">Pick a section to explore designs.</p>
  <div id="sectionsGallery" class="product-gallery"></div>
</main>

<script>
 //_BASE = "https://lailastreasures.onrender.com";

  function sectionFallbackImage(slug){
    const s = (slug || "").toLowerCase();
    if (s.includes("gold")) return "assets/images/grillz1.jpg";
    if (s.includes("silver")) return "assets/images/grillz2.jpg";
    if (s.includes("rose")) return "assets/images/grillz3.jpg";
    return "assets/images/gold1.jpg";
  }
  function normalizeImg(src, slug){
    if (!src) return sectionFallbackImage(slug);
    if (src.startsWith("http") || src.startsWith("assets/")) return src;
    return "assets/images/" + src;
  }

  // We now route to ONE page: section.html?slug=...
  function hrefForSection(slug){
    return `section.html?slug=${encodeURIComponent(slug)}`;
  }

  async function loadSections(){
    const wrap = document.getElementById("sectionsGallery");
    wrap.innerHTML = "Loading…";
    try {
      const r = await fetch(`${API_BASE}/api/sections`);
      if (!r.ok) throw new Error(`Failed to fetch sections (${r.status})`);
      const sections = await r.json();
      if (!Array.isArray(sections) || sections.length === 0){
        wrap.innerHTML = "<p>No sections found yet.</p>";
        return;
      }
      sections.sort((a,b)=>{
        if (typeof a.position === 'number' && typeof b.position === 'number') {
          return a.position - b.position;
        }
        return (a.name||'').localeCompare(b.name||'');
      });

      wrap.innerHTML = "";
      sections.forEach(sec=>{
        const card = document.createElement("div");
        card.className = "product";
        const img = normalizeImg(sec.image, sec.slug);
        const name = sec.name || "Section";
        const href = hrefForSection(sec.slug || "grillz");
        card.innerHTML = `
          <img src="${img}" alt="${name}">
          <h2>${name}</h2>
          <a href="${href}"><button>Explore</button></a>
        `;
        wrap.appendChild(card);
      });
    } catch (err) {
      console.error(err);
      wrap.innerHTML = `<p style="color:#b00020">Error: ${err.message}</p>`;
    }
  }

  document.addEventListener("DOMContentLoaded", loadSections);
</script>
</body>
</html>